var TextInput=React.createClass({displayName:"TextInput",validateTextInput:function(a){function b(a){return!isNaN(parseInt(a))&&isFinite(a)}var c=$(a.target),d=c.val();switch(this.props.data.type){case'input[type="text"]':this.props.data.value=d;break;case'input[type="number"]':this.props.data.value=d?b(d)?d:this.props.data.value:d}this.props.onChange(this.props.key,this.props.data)},render:function(){return React.DOM.div({className:"form-group"},React.DOM.label({className:"control-label col-sm-3",htmlFor:this.props.key},this.props.data.name),React.DOM.div({className:"col-sm-7"},React.DOM.input({type:"text",className:"form-control",placeholder:this.props.data.placeholder,value:this.props.data.value,onChange:this.validateTextInput,name:this.props.key,id:this.props.key,required:this.props.data.required})))}}),TextArea=React.createClass({displayName:"TextArea",validateTextInput:function(a){var b=$(a.target);this.props.data.value=b.val(),this.props.onChange(this.props.key,this.props.data)},render:function(){return React.DOM.div({className:"form-group"},React.DOM.label({className:"control-label col-sm-3",htmlFor:this.props.key},this.props.data.name),React.DOM.div({className:"col-sm-7"},React.DOM.textarea({rows:"5",className:"form-control",placeholder:this.props.data.placeholder,value:this.props.data.value,onChange:this.validateTextInput,name:this.props.key,id:this.props.key,required:this.props.data.required})))}}),CheckboxInput=React.createClass({displayName:"CheckboxInput",_handleCheckboxChange:function(a){this.props.data.value=this.props.data.value.map(function(b){return b.selected=b.id===a?!b.selected:b.selected,b}),this.props.onChange(this.props.key,this.props.data)},render:function(){var a=this.props.data.value.map(function(a){return React.DOM.label({className:"checkbox-inline",htmlFor:a.id},React.DOM.input({type:"checkbox",id:a.id,name:this.props.key,value:a.id,checked:a.selected,onChange:this._handleCheckboxChange.bind(this,a.id)}),a.name)}.bind(this));return React.DOM.div({className:"form-group"},React.DOM.label({className:"control-label col-sm-3",htmlFor:this.props.key},this.props.data.name),React.DOM.div({className:"col-sm-7"},a))}}),NewCourse=React.createClass({displayName:"NewCourse",_getEmptyFormData:function(){return{name:{name:"Name",type:'input[type="text"]',value:"",required:!0,placeholder:"Carnatic Guitar Techniques"},description:{name:"Description",type:"textarea",value:"",required:!0,placeholder:"A capable guitarist wanting to learn left and right hand techniques, triads, vibrato, bending, picking techniques, how to arpeggiate chords etc"},target_audience:{name:"Target Audience",type:'input[type="checkbox"]',value:[{id:"beg",selected:!0,name:"Beginner"},{id:"inter",selected:!0,name:"Intermediate"},{id:"adv",selected:!0,name:"Advanced"}],required:!0},classes:{name:"Number of classes",type:'input[type="number"]',value:"",required:!0,placeholder:"4"},fee:{name:"Course fee (Rs.)",type:'input[type="number"]',value:"",required:!0,placeholder:"2000"}}},getInitialState:function(){if(this.props.course){var a=this._getEmptyFormData();return _.each(_.keys(a),function(b){a[b].value=this.props.course[b]},this),a._id=this.props.course._id,a}return this._getEmptyFormData()},handleTextFieldChange:function(a,b){var c={};c[a]=b,this.setState(c)},handleCheckboxChange:function(a,b){var c={};c[a]=b,this.setState(c)},_resetForm:function(){this.props.course?this.props.onCourseEditingCancelled():this.setState(this._getEmptyFormData()),this.props.onFormVisibility&&this.props.onFormVisibility(!1)},handleNewCourseFormSubmit:function(a){a.preventDefault();var b={};_.each(_.keys(this.state),function(a){b[a]=this.state[a].value},this),this.props.course?(b._id=this.state._id,$.ajax({url:"/api/guru/course",type:"PUT",data:b,dataType:"json",success:function(a){this.props.onCourseEdited(a),this._resetForm(),mixpanel.track("Edited course",a)}.bind(this)})):$.post("/api/guru/course",b,function(a){this.props.onNewCourse(a),this._resetForm(),mixpanel.track("Created new course",a)}.bind(this))},render:function(){var a=_.keys(this.state).map(function(a){var b=this.state[a];if(!b.type)return null;switch(b.type){case"textarea":return TextArea({data:b,key:a,onChange:this.handleTextFieldChange});case'input[type="checkbox"]':return CheckboxInput({data:b,key:a,onChange:this.handleCheckboxChange});default:return TextInput({data:b,key:a,onChange:this.handleTextFieldChange})}}.bind(this)),b=function(){return this.props.course?"Edit course":"Add new course"},c=function(){return this.props.course?"":"panel panel-default pad-10"},d=function(){return this.props.isVisible?React.DOM.div({id:"courseFormContainer",className:"text-left"},React.DOM.div({className:c.call(this)},React.DOM.legend(null,b.call(this)),React.DOM.form({className:"form-horizontal",role:"form",onSubmit:this.handleNewCourseFormSubmit},a,React.DOM.div({className:"form-group"},React.DOM.div({className:"col-sm-offset-3 col-sm-9"},React.DOM.button({type:"submit",className:"btn btn-success mr-20",id:"saveSchedule"},"Save"),React.DOM.a({className:"btn btn-link",onClick:this._resetForm},"Cancel")))))):React.DOM.div(null)};return React.DOM.div(null,d.call(this))}}),ExistingCourseItem=React.createClass({displayName:"ExistingCourseItem",getInitialState:function(){return{isEditMode:!1}},_getTargetAudience:function(a){return a.target_audience.map(function(a){return a.selected?React.DOM.li({className:"item capitalize"},a.name):void 0},this)},handleOnDelete:function(a){a.preventDefault(),confirm("Are you sure you want to delete this course?")&&this.props.onDeleteCourse(this.props.course._id)},handleOnEdit:function(){this.setState({isEditMode:!0})},handleOnCourseEdited:function(a){this.props.onCourseChange(a),this.onCourseEditingCancelled()},onCourseEditingCancelled:function(){this.setState({isEditMode:!1})},render:function(){return this.state.isEditMode?React.DOM.li({className:"item"},NewCourse({course:this.props.course,isVisible:!0,onCourseEdited:this.handleOnCourseEdited,onCourseEditingCancelled:this.onCourseEditingCancelled})):React.DOM.li({className:"item"},React.DOM.div({className:"row"},React.DOM.div({className:"col-md-7"},React.DOM.h4({className:"text-item-heading"},this.props.course.name),React.DOM.p({className:"text-light"},this.props.course.description)),React.DOM.div({className:"col-md-5 relative"},React.DOM.div({className:"mb-10"},React.DOM.strong(null,"Classes: "),this.props.course.classes),React.DOM.div({className:"mb-10"},React.DOM.strong(null,"Fee: "),React.DOM.i({className:"fa fa-rupee"}),this.props.course.fee),React.DOM.div({className:"mb-10"},React.DOM.strong(null,"Audience: "),React.DOM.ul({className:"l-h-list inline-block"},this._getTargetAudience.call(this,this.props.course))),React.DOM.div({className:"course-action"},React.DOM.a({className:"editCourse mr-10",onClick:this.handleOnEdit},React.DOM.i({className:"fa fa-pencil-square-o"})," Edit "),React.DOM.a({className:"deleteCourse",onClick:this.handleOnDelete},React.DOM.i({className:"fa fa-trash-o"})," Delete ")))))}}),ExistingCourses=React.createClass({displayName:"ExistingCourses",render:function(){var a=this.props.courses.map(function(a){return ExistingCourseItem({course:a,onDeleteCourse:this.props.onDeleteCourse,onCourseChange:this.props.onCourseChange})},this);return React.DOM.div({id:"existingCourses",className:"has-min-height"},React.DOM.ul({className:"l-v-list v-flat-list list-unstyled"},a))}}),CourseManagement=React.createClass({displayName:"CourseManagement",getInitialState:function(){return{courses:[],user:{},isNewCourseFormVisible:!1}},componentWillMount:function(){$.getJSON("/api/guru/courses",function(a){this.setState({courses:a}),this.state.courses.length||this.handleFormVisibility(!0)}.bind(this)),$.getJSON("/api/guru/user",function(a){a&&(this.setState({user:a}),mixpanel.identify(a.email),mixpanel.people.set({$email:a.email,$name:a.name,$last_login:new Date}),mixpanel.track("Visited Course page"))}.bind(this))},handleNewCourse:function(a){this.state.courses.push(a),this.setState({courses:this.state.courses}),this.handleFormVisibility(!1)},handleFormVisibility:function(a){this.setState({isNewCourseFormVisible:a})},handleOnDeleteCourse:function(a){this.state.courses=_.reject(this.state.courses,function(b){return b._id===a},this),this.setState({courses:this.state.courses}),$.ajax({url:"/api/guru/course",method:"DELETE",dataType:"json",data:{_id:a}})},handleOnCourseChange:function(a){this.setState({courses:this.state.courses.map(function(b){return b._id===a._id?a:b},this)})},render:function(){var a={"margin-top":60};return React.DOM.div(null,React.DOM.div({className:"row"},React.DOM.div({className:"col-md-9"},React.DOM.h3(null,"Manage Courses"),React.DOM.p({className:"text-light"}," These courses will be a part of your online academy. ")),React.DOM.div({className:"col-md-3"},React.DOM.div({className:"pull-right"},React.DOM.div({style:a}),React.DOM.a({id:"addNewCourse",onClick:this.handleFormVisibility.bind(this,!0)},React.DOM.i({className:"fa fa-plus-circle"})," Add New Course ")))),NewCourse({onNewCourse:this.handleNewCourse,isVisible:this.state.isNewCourseFormVisible,onFormVisibility:this.handleFormVisibility}),React.DOM.div({className:"mb-40"}),ExistingCourses({courses:this.state.courses,onDeleteCourse:this.handleOnDeleteCourse,onCourseChange:this.handleOnCourseChange}))}});React.renderComponent(CourseManagement(null),document.getElementById("courseManagement"));