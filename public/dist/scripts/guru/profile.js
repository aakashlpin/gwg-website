var TextBoxComponent=React.createClass({displayName:"TextBoxComponent",handleChangeInTextBox:function(a,b){this.props.itemValue.value=b.target.value,this.props.handleStateChange(a,this.props.itemValue)},_getLabelForItem:function(a){return a.name},_getFormElement:function(a,b){return"input"==b.formElement?React.DOM.input({className:"form-control",name:a,id:a,value:b.value,onChange:this.handleChangeInTextBox.bind(this,a),placeholder:b.placeholder}):React.DOM.textarea({className:"form-control",name:a,id:a,value:b.value,onChange:this.handleChangeInTextBox.bind(this,a),rows:"5",placeholder:b.placeholder})},_getInput:function(){var a=this.props.itemKey,b=this.props.itemValue;return React.DOM.div({className:"form-group"},React.DOM.label({className:"control-label col-sm-3",htmlFor:a},this._getLabelForItem.call(this,b)),React.DOM.div({className:"col-sm-7"},this._getFormElement.call(this,a,b)))},render:function(){return this._getInput()}}),ProfileManagement=React.createClass({displayName:"ProfileManagement",getInitialState:function(){return{data:{about_me:{name:"About me",value:"",formElement:"textarea",placeholder:"I am the lead guitarist and a songwriter in the heavy metal band Metallica and have been a member of the band since 1983. Before joining Metallica I formed and named the band Exodus."},band_name:{name:"Name a band you have been associated with",value:"",formElement:"input",placeholder:"Metallica"},links:{name:"List of links you would like to share (one per line)",value:"",formElement:"textarea",placeholder:"http://www.mtv.com/artists/metallica"},phone:{name:"Phone number",value:"",formElement:"input",placeholder:"+91-9090898989"}},isDirty:!0,user:{}}},componentWillMount:function(){$.getJSON("/api/guru/profile",function(a){if(a&&(!a||a.extras)){var b=_.extend({},a.extras);_.each(_.keys(b),function(a){this.state.data[a].value="textarea"==this.state.data[a].formElement?b[a].join("\n"):b[a]},this),this.setState({data:this.state.data})}}.bind(this)),$.getJSON("/api/guru/user",function(a){a&&(this.setState({user:a}),mixpanel.identify(a.email),mixpanel.people.set({$email:a.email,$name:a.name,$last_login:new Date}),mixpanel.track("Visited Profile page"))}.bind(this))},handleStateChange:function(a,b){this.state.data[a]=b,this.setState({data:this.state.data,isDirty:!0})},_getFormComponents:function(){return _.keys(this.state.data).map(function(a){return TextBoxComponent({itemKey:a,itemValue:this.state.data[a],handleStateChange:this.handleStateChange})},this)},handleProfileFormSubmit:function(a){a.preventDefault();var b={},c=$.extend(!0,{},this.state.data);_.each(_.keys(c),function(a){var d=c[a];"textarea"==d.formElement&&(d.value=d.value.split("\n")),b[a]=d.value},this),$.post("/api/guru/profile",{extras:b},function(a){a&&this.setState({isDirty:!1})}.bind(this)),mixpanel.track("Profile changed and saved")},getSubmitButtonType:function(){return this.state.isDirty?React.DOM.button({type:"submit",className:"btn btn-success"},"Save"):React.DOM.button({type:"submit",className:"btn btn-primary"},"Saved")},render:function(){return React.DOM.div({className:"has-min-height"},React.DOM.h3(null,"Profile"),React.DOM.p({className:"gwg-callout gwg-callout-info text-light"}," * Tell us a bit about yourself. This will help us feature you on our homepage. "),React.DOM.p({className:"gwg-callout gwg-callout-warning text-light"},React.DOM.strong(null,"New: ")," Share your music with the world! Import your ",React.DOM.a({className:"underline",href:"/g/apps"},"Youtube videos")," and ",React.DOM.a({className:"underline",href:"/g/apps"},"SoundCloud songs")," into your profile. "),React.DOM.div({className:"pad-10"},React.DOM.form({className:"form-horizontal",role:"form",onSubmit:this.handleProfileFormSubmit},this._getFormComponents(),React.DOM.div({className:"form-group"},React.DOM.div({className:"col-sm-offset-3 col-sm-9"},this.getSubmitButtonType.call(this))))))}});React.renderComponent(ProfileManagement(null),document.getElementById("profileManagement"));